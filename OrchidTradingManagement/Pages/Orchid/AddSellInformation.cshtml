@page
@model OrchidTradingManagement.Pages.Orchid.AddSellInformationModel
@{
}

@{
    String jsonString = HttpContext.Session.GetString("userId");

    if (!string.IsNullOrEmpty(jsonString))
    {
        if (!jsonString.Equals("e7c115d3-a70a-4a16-b891-c45bd0425a00"))
        {
<div>
    <div>
        <h1>
            Add Sell Information
        </h1>
    </div>
</div>

<div>
    <div>
        <form method="post">
            <div class="mb-3">
                <label for="heading" class="form-label">Title:</label>
                <input type="text" class="form-control" id="title" asp-for="AddListInformationRequest.Title">
                <span class="text-danger" asp-validation-for="AddListInformationRequest.Title"></span>
            </div>

            <div class="mb-3">
                <label for="heading" class="form-label">Description:</label>
                <input type="text" class="form-control" id="description" asp-for="AddListInformationRequest.Description">
                <span class="text-danger" asp-validation-for="AddListInformationRequest.Description"></span>
            </div>

            <div class="mb-3">
                <label for="featuredImageUpload" class="form-label">Featured Image Upload</label>
                <input type="file" id="featuredImageUpload" asp-for="FeaturedImage"/>
                <img src="" id="featuredImageDisplay" style="display:none; width:300px;" />
            </div>

            <div class="mb-3">
                <label for="image" class="form-label">Image:</label>
                <input type="text" class="form-control" id="image" asp-for="AddListInformationRequest.Image" readonly>
                <span class="text-danger" asp-validation-for="AddListInformationRequest.Image"></span>
            </div>

            <div class="form-group">
                <label asp-for="AddOrchidRequest.OrchidName" class="form-label">Orchid Name:</label>
                <textarea asp-for="AddOrchidRequest.OrchidName" class="form-control"></textarea>
                <span class="text-danger" asp-validation-for="AddOrchidRequest.OrchidName"></span>
            </div>
            <div class="form-group">
                <label asp-for="AddOrchidRequest.Characteristic" class="form-label">Characteric:</label>
                <textarea asp-for="AddOrchidRequest.Characteristic" class="form-control"></textarea>
                <span class="text-danger" asp-validation-for="AddOrchidRequest.Characteristic"></span>
            </div>
            <div class="form-group">
                <label asp-for="AddOrchidRequest.UnitPrice" class="form-label">UnitPrice:</label>
                <textarea asp-for="AddOrchidRequest.UnitPrice" class="form-control"></textarea>
                            <span class="text-danger" asp-validation-for="AddOrchidRequest.UnitPrice"></span>
            </div>
            <div class="form-group">
                <label asp-for="AddOrchidRequest.Quantity" class="form-label">Quantity:</label>
                <textarea asp-for="AddOrchidRequest.Quantity" class="form-control"></textarea>
                <span class="text-danger" asp-validation-for="AddOrchidRequest.Quantity"></span>
            </div>

            <div class="mb-3">
                <button class="btn btn-primary" type="submit">Submit</button>
            </div>

        </form>
    </div>
</div>

@section Scripts{
    <script>

        const featuredImageUploadElement = document.getElementById('featuredImageUpload');
        const image = document.getElementById('image');
        const featuredImageDisplay = document.getElementById('featuredImageDisplay');

        async function uploadFeaturedImage(e){
            console.log(e.target.files[0]);

            let data = new FormData();
            data.append('file', e.target.files[0]);

            await fetch('/api/images', {
                method: 'Post',
                headers: {
                    'Accept': '*/*'
                },
                body: data
            }).then(response => response.json())
                .then(result => {
                    image.value = result.link;
                    featuredImageDisplay.style.display = 'block';
                    featuredImageDisplay.src = result.link;
                });
        }


        featuredImageUploadElement.addEventListener('change', uploadFeaturedImage);
    </script>
}

        }
        else
        {
            <h1>Access Denied</h1>
        }
    }
    else
    {
        <h1>You haven't logined</h1>
    }
}